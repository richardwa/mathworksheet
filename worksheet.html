<!doctype html>
<html>

<head>
  <meta charset="utf-8">

  <title>Math World - worksheet</title>

  <link rel='shortcut icon' type='image/x-icon' href='favicon.png'>
  <link rel="stylesheet" type="text/css" href="main.css">
  <style>
    body {
      font-size: 35pt;
    }

    span {
      padding: 1ch 0;
      display: inline-block;
    }

    label {
      display: inline-block;
      text-align: right;
    }

    a {
      color: black;
    }
  </style>
</head>

<body>
</body>

</html>
<script type="module">
  import * as jx from './js/render.js';
  import {getState, setState, onStateChange} from './js/urlstate.js';
  import {rand, pickOne} from './js/random.js';
  const state = getState(() => ({
      operations: ['+', '-'],
      termLengths: [3, 2]
    }));

  function field(a, size) {
    return `<label style='width: ${size}ch'>${a.toLocaleString()}</label>`;
  }

  function listNumber(i) {
    return `<i style='color:gray'>${(i + 1).toString().padStart(2, '0')})</i>`;
  }

  function question(num, operations, ...rest) {
    const op = pickOne(...operations);
    const total = rest.reduce((a, v, i) => a + v, 0) + 3 * (rest.length - 1) + 16;
    const terms = rest.map(size => rand(size));
    const solution = eval(terms.join(op));
    if (solution <= 0) {
      //no negative answers, choose other random terms
      return question(num, op, ...rest);
    } else {
      const expr = rest.map((size, i) => field(terms[i], size)).join(` ${op} `);
      return [
        `<span style='width: ${total}ch'>`,
        `${listNumber(num)} ${expr} `,
        `<a href='javascript:alert(${solution.toLocaleString()})'> = </a>`,
        '</span>'
      ].join('');
    }
  }

  function render() {
    const {operations, termLengths} = getState();
    return [
      '<div class=page>',
      // generate a problem with 2 terms, first one 3 digits and second one 2 digits
      ...Array.from({
          length: 26
        },
        (x, i) => `${question(i, operations, ...termLengths)}`),
      '</div>'
    ].join('');
  }

  const rerender = jx.render(render);
  onStateChange(rerender);
</script>